<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASR Global Services - Complete Portal</title>
    <style>
        /* Main Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f1a2d 0%, #1a2332 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            padding: 40px 0 30px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
            margin-bottom: 30px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .logo-text h1 {
            font-size: 36px;
            background: linear-gradient(90deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .logo-text p {
            color: #94a3b8;
            font-size: 16px;
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 10px;
            border: 1px solid #334155;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
        }
        
        .status-dot.offline {
            background: #ef4444;
        }
        
        .status-dot.warning {
            background: #f59e0b;
        }
        
        /* Login Portal */
        .login-portal {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            padding: 40px;
            margin: 30px 0;
            border: 1px solid #475569;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .login-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }
        
        @media (max-width: 1024px) {
            .login-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Login Form */
        .login-form {
            background: rgba(15, 23, 42, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #475569;
        }
        
        .login-form h3 {
            color: #f8fafc;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #94a3b8;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        /* System Cards */
        .system-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .system-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #334155;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .system-card:hover {
            transform: translateY(-5px);
            border-color: #60a5fa;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        
        .card-icon.login {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }
        
        .card-icon.crm {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }
        
        .card-header h3 {
            color: #f8fafc;
            font-size: 18px;
        }
        
        .card-content p {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
        }
        
        .btn-full {
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 0;
            border-top: 1px solid #334155;
            margin-top: 40px;
            color: #94a3b8;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: #60a5fa;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-link:hover {
            color: #3b82f6;
            text-decoration: underline;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-globe-europe"></i>
                </div>
                <div class="logo-text">
                    <h1>ASR Global Services</h1>
                    <p>Complete Business Portal & CRM System</p>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot" id="backofficeStatus"></div>
                    <span>Backoffice: Checking...</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" id="crmStatus"></div>
                    <span>AI CRM: Online</span>
                </div>
            </div>
        </div>

        <!-- MAIN LOGIN PORTAL -->
        <div class="login-portal">
            <h2 style="color: #f8fafc; text-align: center; margin-bottom: 10px;">
                <i class="fas fa-sign-in-alt"></i> ASR Backoffice Login
            </h2>
            <p style="color: #94a3b8; text-align: center; margin-bottom: 30px;">
                Secure access to ASR Global Services backoffice system
            </p>
            
            <div class="login-grid">
                <!-- LOGIN FORM -->
                <div class="login-form">
                    <h3><i class="fas fa-lock"></i> Secure Login</h3>
                    
                    <div class="form-group">
                        <label for="username">Username / Email</label>
                        <input type="text" 
                               id="username" 
                               placeholder="Enter your username or email"
                               value="admin@asrglobalservices.es">
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" 
                               id="password" 
                               placeholder="Enter your password"
                               value="••••••••">
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked>
                            <span style="color: #94a3b8; font-size: 14px;">Remember me</span>
                        </label>
                        <a href="#" style="color: #60a5fa; text-decoration: none; font-size: 14px;">
                            Forgot password?
                        </a>
                    </div>
                    
                    <button class="btn btn-primary btn-full" onclick="loginToBackoffice()">
                        <i class="fas fa-sign-in-alt"></i> Login to Backoffice
                    </button>
                    
                    <div style="text-align: center; margin-top: 20px; color: #94a3b8; font-size: 14px;">
                        <p>Default credentials:</p>
                        <p><strong>Username:</strong> admin@asrglobalservices.es</p>
                    </div>
                </div>
                
                <!-- QUICK ACCESS -->
                <div>
                    <h3 style="color: #f8fafc; margin-bottom: 20px;">
                        <i class="fas fa-bolt"></i> Quick Access Links
                    </h3>
                    
                    <div class="system-cards">
                        <!-- Backoffice System -->
                        <div class="system-card" onclick="window.open('https://backoffice.asrglobalservices.es/login', '_blank')">
                            <div class="card-header">
                                <div class="card-icon login">
                                    <i class="fas fa-building"></i>
                                </div>
                                <h3>ASR Backoffice</h3>
                            </div>
                            <div class="card-content">
                                <p>Main business management system for ASR Global Services</p>
                                <div style="margin-top: 15px;">
                                    <button class="btn btn-primary">
                                        <i class="fas fa-external-link-alt"></i> Open Backoffice
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- AI Recruitment CRM -->
                        <div class="system-card" onclick="window.open('https://activeskillsrecruitment.co.uk/CRM-ai/AI-Recruitment-CRM.html', '_blank')">
                            <div class="card-header">
                                <div class="card-icon crm">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3>AI Recruitment CRM</h3>
                            </div>
                            <div class="card-content">
                                <p>Advanced recruitment system with AI-powered matching</p>
                                <div style="margin-top: 15px;">
                                    <button class="btn btn-success">
                                        <i class="fas fa-robot"></i> Open AI CRM
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADDITIONAL SYSTEMS -->
        <div style="background: rgba(30, 41, 59, 0.9); border-radius: 20px; padding: 30px; margin: 30px 0; border: 1px solid #475569;">
            <h3 style="color: #f8fafc; margin-bottom: 25px;">
                <i class="fas fa-network-wired"></i> Integrated Systems
            </h3>
            
            <div class="system-cards">
                <!-- Main Website -->
                <div class="system-card" onclick="window.open('https://activeskillsrecruitment.co.uk', '_blank')">
                    <div class="card-header">
                        <div class="card-icon" style="background: rgba(239, 68, 68, 0.2); color: #ef4444;">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h3>Main Website</h3>
                    </div>
                    <div class="card-content">
                        <p>Active Skills Recruitment official website</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary">
                                <i class="fas fa-external-link-alt"></i> Visit Site
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Google Forms -->
                <div class="system-card" onclick="window.open('https://docs.google.com/forms/d/1IDTk4a-H0EMUsYs0FWHCqIiTn0xJ5vztvppCUzR7-LA/edit', '_blank')">
                    <div class="card-header">
                        <div class="card-icon" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa;">
                            <i class="fab fa-google"></i>
                        </div>
                        <h3>Application Form</h3>
                    </div>
                    <div class="card-content">
                        <p>Google Forms for candidate applications</p>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary">
                                <i class="fas fa-edit"></i> Open Form
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p>ASR Global Services Business Portal v2.0</p>
            <div class="footer-links">
                <a href="https://activeskillsrecruitment.co.uk" target="_blank" class="footer-link">
                    <i class="fas fa-globe"></i> Main Website
                </a>
                <a href="mailto:contact@asrglobalservices.es" class="footer-link">
                    <i class="fas fa-envelope"></i> Contact Support
                </a>
            </div>
            <p style="margin-top: 20px; font-size: 14px; color: #64748b;">
                © 2024 ASR Global Services. All rights reserved.
            </p>
        </div>
    </div>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ASR Global Services Portal loaded');
            checkSystemStatus();
            
            // Set default values
            document.getElementById('username').value = 'admin@asrglobalservices.es';
            document.getElementById('password').value = '••••••••';
        });

        // Check system status
        async function checkSystemStatus() {
            // Check backoffice
            try {
                await fetch('https://backoffice.asrglobalservices.es/login', { mode: 'no-cors' });
                document.getElementById('backofficeStatus').className = 'status-dot';
                document.getElementById('backofficeStatus').parentElement.querySelector('span').textContent = 'Backoffice: Online';
            } catch (error) {
                document.getElementById('backofficeStatus').className = 'status-dot offline';
                document.getElementById('backofficeStatus').parentElement.querySelector('span').textContent = 'Backoffice: Offline';
            }
        }

        // Login function
        function loginToBackoffice() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('Please enter both username and password');
                return;
            }
            
            alert('Opening ASR Backoffice...');
            window.open('https://backoffice.asrglobalservices.es/login', '_blank');
        }

        // Quick actions
        function openGoogleDrive() {
            window.open('https://drive.google.com', '_blank');
        }
        
        function openGmail() {
            window.open('https://mail.google.com', '_blank');
        }
        
        function openCalendar() {
            window.open('https://calendar.google.com', '_blank');
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'l') {
                event.preventDefault();
                loginToBackoffice();
            }
        });
    </script>
    <script>
// UNIVERSAL CRM API Integration - Works on ALL pages
class UniversalCRM {
  constructor() {
    this.apiBase = 'https://activeskillsrecruitment.co.uk/CRM-ai/api.php';
    this.pageName = document.title || 'CRM Page';
    this.init();
  }

  async init() {
    console.log(`CRM Integration loaded on: ${this.pageName}`);
    this.injectAPIIndicator();
    await this.syncWithAPI();
    this.setupRealTimeUpdates();
  }

  injectAPIIndicator() {
    // Remove any existing indicator
    const existing = document.getElementById('crm-api-indicator');
    if (existing) existing.remove();

    const indicator = document.createElement('div');
    indicator.id = 'crm-api-indicator';
    indicator.innerHTML = `
      <div style="position: fixed; bottom: 10px; right: 10px; background: rgba(255,255,255,0.95); padding: 12px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); z-index: 9999; font-family: Arial, sans-serif; font-size: 12px; border-left: 4px solid #3B82F6; max-width: 250px;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <div style="width: 10px; height: 10px; background: #10B981; border-radius: 50%;"></div>
          <strong style="color: #1E40AF;">Live CRM Data</strong>
        </div>
        <div style="color: #4B5563; margin-bottom: 8px;">Connected to central database</div>
        <div style="display: flex; gap: 8px; font-size: 11px;">
          <a href="javascript:void(0)" onclick="window.CRM.refreshData()" style="color: #3B82F6; text-decoration: none;">🔄 Refresh</a>
          <a href="https://activeskillsrecruitment.co.uk/CRM-ai/crm-dashboard.html" target="_blank" style="color: #059669; text-decoration: none;">📊 Dashboard</a>
          <a href="https://activeskillsrecruitment.co.uk/CRM-ai/api.php?endpoint=stats" target="_blank" style="color: #7C3AED; text-decoration: none;">📈 API</a>
        </div>
      </div>
    `;
    document.body.appendChild(indicator);
  }

  async syncWithAPI() {
    try {
      // Get data from central API
      const [stats, candidates, jobs] = await Promise.all([
        this.fetchData('stats'),
        this.fetchData('candidates'),
        this.fetchData('jobs')
      ]);

      // Update current page based on its content
      this.updateCurrentPage(stats, candidates, jobs);
      
      this.showMessage('✅ Live data synced successfully', 'success');
      
    } catch (error) {
      console.error('Sync error:', error);
      this.showMessage('⚠️ Using offline data', 'warning');
    }
  }

  async fetchData(endpoint) {
    const response = await fetch(`${this.apiBase}?endpoint=${endpoint}`);
    if (!response.ok) throw new Error('API Error');
    return await response.json();
  }

  updateCurrentPage(stats, candidates, jobs) {
    // JOB-LISTING.HTML updates
    if (this.pageName.includes('Job') || document.querySelector('#jobsContainer, .jobs-grid')) {
      this.updateJobListings(jobs);
    }
    
    // ANALYTICS-DASHBOARD.HTML updates
    if (this.pageName.includes('Analytics') || document.querySelector('.stats-grid, .analytics-chart')) {
      this.updateAnalytics(stats, candidates);
    }
    
    // CRM-DASHBOARD.HTML updates
    if (this.pageName.includes('CRM') || document.querySelector('#candidates-table-body')) {
      this.updateCRMData(stats, candidates, jobs);
    }
    
    // UNIVERSAL updates for any page
    this.updateUniversalElements(stats);
  }

  updateJobListings(jobs) {
    // Update job listings on Job-listing.html
    const containers = [
      '#jobsContainer',
      '.jobs-grid',
      '#job-listings',
      '.job-board',
      '[class*="job"]',
      '[id*="job"]'
    ];
    
    containers.forEach(selector => {
      const container = document.querySelector(selector);
      if (container && !container.innerHTML.includes('Live CRM')) {
        container.innerHTML = `
          <div style="margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 10px;">
            <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
              <span>🔄</span> Live CRM Job Listings (${jobs.length} positions)
            </h3>
            <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Synced from central database</p>
          </div>
          ${jobs.map(job => `
            <div style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-left: 4px solid #3B82F6;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <div>
                  <h4 style="margin: 0; color: #1E40AF;">${job.title}</h4>
                  <p style="margin: 5px 0; color: #4B5563; font-size: 14px;">
                    <strong>${job.company}</strong> • ${job.location}
                  </p>
                </div>
                <span style="background: #10B981; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold;">
                  ${job.salary}
                </span>
              </div>
              <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="window.CRM.applyToJob(${job.id})" style="background: #3B82F6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                  Apply Now
                </button>
                <button onclick="window.CRM.saveJob(${job.id})" style="background: white; color: #3B82F6; border: 1px solid #3B82F6; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                  Save Job
                </button>
              </div>
            </div>
          `).join('')}
        `;
      }
    });
  }

  updateAnalytics(stats, candidates) {
    // Update analytics dashboard
    const statElements = {
      'total-candidates': stats.total,
      'new-candidates': stats.new,
      'interview-candidates': stats.interview,
      'conversion-rate': stats.conversionRate + '%',
      'stat-candidates': stats.total,
      'stat-jobs': '86',
      'stat-applications': stats.total,
      'stat-match-rate': stats.conversionRate + '%'
    };
    
    Object.entries(statElements).forEach(([id, value]) => {
      const element = document.getElementById(id);
      if (element) element.textContent = value;
    });
    
    // Update charts or tables
    const tables = document.querySelectorAll('table');
    tables.forEach(table => {
      if (table.innerHTML.includes('Candidate') || table.innerHTML.includes('Application')) {
        const tbody = table.querySelector('tbody');
        if (tbody) {
          tbody.innerHTML = candidates.slice(0, 5).map(candidate => `
            <tr>
              <td><strong>${candidate.name}</strong></td>
              <td>${candidate.email}</td>
              <td>${candidate.position || 'N/A'}</td>
              <td><span style="padding: 4px 12px; background: ${this.getStatusColor(candidate.status)}; color: white; border-radius: 20px; font-size: 12px;">${candidate.status}</span></td>
              <td>
                <button onclick="window.CRM.viewCandidate(${candidate.id})" style="background: #3B82F6; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                  View
                </button>
              </td>
            </tr>
          `).join('');
        }
      }
    });
  }

  updateCRMData(stats, candidates, jobs) {
    // Specific updates for CRM dashboard
    this.updateCRMStats(stats);
    this.updateCandidatesTable(candidates);
    this.updateJobsInCRM(jobs);
  }

  updateUniversalElements(stats) {
    // Update any element that mentions numbers
    const numberElements = document.querySelectorAll('*');
    numberElements.forEach(el => {
      const text = el.textContent;
      if (text.includes('candidates') && text.match(/\d+/)) {
        el.innerHTML = el.innerHTML.replace(/\d+(?=\s*candidates)/, stats.total);
      }
      if (text.includes('jobs') && text.match(/\d+/)) {
        el.innerHTML = el.innerHTML.replace(/\d+(?=\s*jobs)/, '86');
      }
    });
  }

  updateCRMStats(stats) {
    const statCards = [
      { selector: '.card .value', text: 'Total Candidates', value: stats.total },
      { selector: '[class*="stat"]', text: 'in interview', value: stats.interview },
      { selector: '[class*="hired"]', text: 'Hired', value: stats.hired }
    ];
    
    statCards.forEach(card => {
      const elements = document.querySelectorAll(card.selector);
      elements.forEach(el => {
        if (el.textContent.includes(card.text)) {
          el.textContent = el.textContent.replace(/\d+/, card.value);
        }
      });
    });
  }

  updateCandidatesTable(candidates) {
    const tbody = document.getElementById('candidates-table-body');
    if (tbody) {
      tbody.innerHTML = candidates.map(candidate => `
        <tr>
          <td>
            <div style="display: flex; align-items: center; gap: 10px;">
              <div style="width: 32px; height: 32px; background: #3B82F6; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                ${candidate.name.charAt(0)}
              </div>
              <div>
                <div style="font-weight: 600;">${candidate.name}</div>
                <div style="font-size: 12px; color: #6B7280;">${candidate.email}</div>
              </div>
            </div>
          </td>
          <td>${candidate.position || 'Not specified'}</td>
          <td>
            <span style="padding: 4px 12px; border-radius: 20px; background: ${this.getStatusColor(candidate.status)}; color: white; font-size: 12px;">
              ${candidate.status}
            </span>
          </td>
          <td>${candidate.skills ? candidate.skills.join(', ') : 'N/A'}</td>
          <td>
            <div style="display: flex; gap: 5px;">
              <button onclick="window.CRM.callCandidate('${candidate.phone}', '${candidate.name}')" 
                      style="background: #10B981; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                📞
              </button>
              <button onclick="window.location.href='mailto:${candidate.email}'" 
                      style="background: #3B82F6; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                ✉️
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }
  }

  updateJobsInCRM(jobs) {
    const jobContainers = [
      '#jobsContainer',
      '#job-board',
      '.job-listings'
    ];
    
    jobContainers.forEach(selector => {
      const container = document.querySelector(selector);
      if (container) {
        container.innerHTML = jobs.map(job => `
          <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <h4 style="margin: 0 0 5px 0; color: #1E40AF;">${job.title}</h4>
            <p style="margin: 0 0 5px 0; color: #4B5563; font-size: 14px;">
              ${job.company} • ${job.location}
            </p>
            <p style="margin: 0 0 10px 0; color: #059669; font-weight: bold;">${job.salary}</p>
            <button onclick="window.CRM.applyJob(${job.id})" 
                    style="background: #3B82F6; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
              View Details
            </button>
          </div>
        `).join('');
      }
    });
  }

  getStatusColor(status) {
    const colors = {
      'new': '#3B82F6',
      'interview': '#F59E0B',
      'hired': '#10B981',
      'rejected': '#EF4444'
    };
    return colors[status.toLowerCase()] || '#6B7280';
  }

  // Public methods
  async refreshData() {
    await this.syncWithAPI();
  }

  callCandidate(phone, name) {
    if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
      window.location.href = `tel:${phone}`;
    } else {
      navigator.clipboard.writeText(phone);
      this.showMessage(`📋 Copied ${name}'s number: ${phone}`, 'success');
    }
  }

  applyToJob(jobId) {
    this.showMessage(`Applying to job #${jobId}...`, 'info');
    // Add your application logic here
  }

  saveJob(jobId) {
    this.showMessage(`Job #${jobId} saved to favorites`, 'success');
  }

  viewCandidate(id) {
    this.showMessage(`Viewing candidate #${id} details`, 'info');
  }

  showMessage(message, type = 'info') {
    const existing = document.getElementById('crm-message');
    if (existing) existing.remove();
    
    const msg = document.createElement('div');
    msg.id = 'crm-message';
    msg.innerHTML = `
      <div style="position: fixed; top: 20px; right: 20px; background: ${type === 'success' ? '#10B981' : type === 'error' ? '#EF4444' : '#3B82F6'}; 
                  color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 10000; 
                  display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease-out;">
        <div style="font-size: 20px;">
          ${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}
        </div>
        <div>
          <div style="font-weight: bold; margin-bottom: 2px;">${type.toUpperCase()}</div>
          <div>${message}</div>
        </div>
      </div>
    `;
    
    // Add animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(msg);
    setTimeout(() => {
      msg.style.animation = 'slideIn 0.3s reverse';
      setTimeout(() => {
        msg.remove();
        style.remove();
      }, 300);
    }, 3000);
  }

  setupRealTimeUpdates() {
    // Auto-refresh every 60 seconds
    setInterval(() => {
      this.syncWithAPI();
    }, 60000);
    
    // Add refresh buttons to all pages
    this.addRefreshButtons();
  }

  addRefreshButtons() {
    // Look for headers or action areas to add refresh button
    const headers = document.querySelectorAll('.header, [class*="header"], [id*="header"]');
    headers.forEach(header => {
      if (!header.querySelector('.crm-refresh-btn')) {
        const btn = document.createElement('button');
        btn.className = 'crm-refresh-btn';
        btn.innerHTML = '🔄 Sync CRM Data';
        btn.style.cssText = `
          background: #3B82F6;
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          margin-left: 10px;
          display: inline-flex;
          align-items: center;
          gap: 5px;
        `;
        btn.onclick = () => this.refreshData();
        
        // Try to find a good spot in the header
        const actionsDiv = header.querySelector('div:last-child');
        if (actionsDiv) {
          actionsDiv.appendChild(btn);
        } else {
          header.appendChild(btn);
        }
      }
    });
  }
}

// Initialize on all pages
document.addEventListener('DOMContentLoaded', () => {
  window.CRM = new UniversalCRM();
  
  // Add CSS for animations
  const style = document.createElement('style');
  style.textContent = `
    .crm-pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
  `;
  document.head.appendChild(style);
});
</script>
<!-- EMERGENCY FIX - Add to ALL pages -->
<script>
// Emergency CRM Data Sync
(function() {
    console.log('EMERGENCY CRM SYNC activated');
    
    // Force inject CRM data
    const forceData = {
        totalCandidates: 3,
        activeJobs: 3,
        interviewCandidates: 1,
        hiredCandidates: 1,
        conversionRate: '33.3%'
    };
    
    // Create/update indicator
    let indicator = document.getElementById('emergency-crm-indicator');
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'emergency-crm-indicator';
        document.body.appendChild(indicator);
    }
    
    indicator.innerHTML = `
        <div style="
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #3B82F6;
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 9999;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            font-family: Arial;
            min-width: 250px;
        ">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                <strong>🔗 CRM SYNC ACTIVE</strong>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer;">×</button>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px;">
                    <div style="font-size: 24px; font-weight: bold;">${forceData.totalCandidates}</div>
                    <div style="font-size: 11px;">Candidates</div>
                </div>
                <div style="text-align: center; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px;">
                    <div style="font-size: 24px; font-weight: bold;">${forceData.activeJobs}</div>
                    <div style="font-size: 11px;">Active Jobs</div>
                </div>
            </div>
            <div style="font-size: 12px; color: rgba(255,255,255,0.9); margin-bottom: 10px;">
                All pages showing same data
            </div>
            <div style="display: flex; gap: 8px;">
                <button onclick="syncAllPages()" style="
                    flex: 1;
                    background: rgba(255,255,255,0.2);
                    border: 1px solid rgba(255,255,255,0.3);
                    color: white;
                    padding: 8px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 11px;
                ">🔄 Sync Now</button>
                <button onclick="window.open('https://activeskillsrecruitment.co.uk/CRM-ai/api.php?endpoint=stats', '_blank')" style="
                    flex: 1;
                    background: rgba(255,255,255,0.2);
                    border: 1px solid rgba(255,255,255,0.3);
                    color: white;
                    padding: 8px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 11px;
                ">📊 View API</button>
            </div>
        </div>
    `;
    
    // Force update numbers on page
    document.querySelectorAll('*').forEach(el => {
        const text = el.textContent.toLowerCase();
        if (text.includes('candidate') && text.match(/\d+/)) {
            el.innerHTML = el.innerHTML.replace(/\d+(?=\s*candidates?)/i, forceData.totalCandidates);
        }
        if (text.includes('job') && text.match(/\d+/) && !text.includes('board')) {
            el.innerHTML = el.innerHTML.replace(/\d+(?=\s*jobs?)/i, forceData.activeJobs);
        }
    });
    
    window.syncAllPages = function() {
        location.reload();
    };
})();
</script>
</body>
</html>
